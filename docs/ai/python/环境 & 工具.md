> 环境配置以 Ubuntu 24.04 (Noble Numbat) 为例

### 如果你使用的是 WSL
部分工具安装过程中可能会使用外网，下面示例是在宿主 Windows 中开启代理，并在 WSL 中设置使用  Windows 的代理。

执行 `vim ~/.profile` 中添加如下指令：
```sh
master=$(ip route | grep default | awk '{print $3}')
export {http,https}_proxy="http://$master:7897"
```
如果终端工具是 fish 则将第一行指令改为 `set master (ip route | grep default | awk '{print $3}')`，其他保持不变。

最后执行 `source ~/.profile` 使其生效。

### 更换 Apt 源

首先备份原始配置：
```sh
sudo cp /etc/apt/sources.list.d/ubuntu.sources /etc/apt/sources.list.d/ubuntu.sources.bak
```

快速命令行全量替换 Url：
```sh
sudo sed -i 's|http://archive.ubuntu.com/ubuntu|http://mirrors.aliyun.com/ubuntu|g' /etc/apt/sources.list.d/ubuntu.sources
sudo sed -i 's|http://security.ubuntu.com/ubuntu|http://mirrors.aliyun.com/ubuntu|g' /etc/apt/sources.list.d/ubuntu.sources
```

修改后的文件看起来应该是这样的：
```sh
Types: deb
URIs: http://mirrors.aliyun.com/ubuntu
Suites: noble noble-updates noble-backports
Components: main restricted universe multiverse
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

Types: deb
URIs: http://mirrors.aliyun.com/ubuntu
Suites: noble-security
Components: main restricted universe multiverse
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg
```

## 工具

#### Homebrew
该示例是安装清华源的 Homebrew 版本，首先是配置环境变量：
```sh
export HOMEBREW_BOTTLE_DOMAIN="https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles"
export HOMEBREW_BREW_GIT_REMOTE="https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git"
export HOMEBREW_CORE_GIT_REMOTE="https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git"
export HOMEBREW_INSTALL_FROM_API=1
```
下载安装脚本：
```sh
git clone --depth=1 https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/install.git brew-install
```
执行安装脚本：
```
/bin/bash brew-install/install.sh
```
安装完成后可执行 `rm -rf brew-install` 删除下载的安装脚本相关文件。

如果你的电脑是 MacOS Apple Silicon CPU，需要将 Homebrew 路径加入到环境变量，将下面指令添加到 Shell 配置中：
```sh
eval "$(/opt/homebrew/bin/brew shellenv)"
```
如果你的电脑是 Linux：
```sh
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
```



#### 使用 fish-shell 作为默认的 Shell 工具
- 使用 brew 安装：
```sh
brew install fish
```
- 官方源安装：
```sh
sudo add-apt-repository ppa:fish-shell/release-4
sudo apt update
sudo apt install fish
```
安装成功后查看 fish 的路径：
```sh
which fish
```
将路径添加到 `/etc/shells`:
```sh
echo /your_fish_path | sudo tee -a /etc/shells
```
设置 Fish 为默认 Shell:
```sh
chsh -s /your_fish_path
```
在配置文件中载入 `.local` ：
```sh
echo 'set -x PATH "$HOME/.local/bin" $PATH' >> ~/.profile.fish
```

然后在 fish-shell 的配置文件中加载用户目录下的 `.profile.fish` 配置：
```sh
echo 'source $HOME/.profile.fish' >> ~/.config/fish/config.fish
```
##### fish-shell 插件
首先需要安装 fish-shell 的插件管理器 fisher：
```sh
curl -sL https://git.io/fisher | source
fisher install jorgebucaran/fisher
```

**nvm 插件（Node.js 管理工具）**
```sh
fisher install jorgebucaran/nvm.fish
```
##### fish-shell 个性化配置

**在终端中不显示当前活动账号的用户名**
```sh
vim ~/.config/fish/functions/fish_prompt.fish

function fish_prompt
    set_color green
    echo -n (prompt_pwd)
    set_color normal
    echo -n ' > '
end
```

#### Git

##### Https 的凭证管理

**MacOS：**
在 macOS 上，如果你安装了 Xcode Command Line Tools 或官方 Git，通常默认已经配置好了，只需要执行以下命令启用它：
```sh
git config --global credential.helper osxkeychain
```
**Linux:**
- 本地凭证存储
```sh
git config --global credential.helper 'store'
```
删除凭证文件：
```sh
rm ~/.git-credentials
```

##### 同步上游远程仓库

将原始仓库（即 fork 来源的项目）添加为新的远程：
```
git remote add upstream https://github.com/original-author/original-repo.git
```

验证是否添加成功：
```
git remote -v
```

获取上游最新代码：
```
git fetch upstream
```

rebase 合并上游仓库代码到本地分支：
```
git rebase upstream/main
```

### Python 环境管理与包管理
推荐使用 uv，后面示例中使用 uv 配置 Python 环境。Pip 与 Miniconda 可以选择安装或不安装。
#### UV
由 Astral 开发，用 Rust 编写。集成了包安装和环境管理，目标是成为下一代 Python 工具链的基石。它兼容 `pip` 和 `pyproject.toml`。

执行以下命令安装 uv：
```sh
curl -LsSf https://astral.sh/uv/install.sh | sh
```
配置 uv 的模块代理：
```sh
echo >> ~/uv.toml << 'EOF'
[[index]]
url = "https://mirrors.ustc.edu.cn/pypi/simple"
default = true
EOF
```

##### Uv 单仓多包添加本地路径依赖

假设仓库的目录结构如下：
```
myapp/
├── src/
│   ├── mypkg1/
|   |   ├── pyproject.toml
|   |   └── ...
│   └── mypkg2/
|       ├── pyproject.toml
|       └── ...
├── pyproject.toml
└── README.md
```

在 mypkg1 包中依赖 mypkg2 包，可以执行以下命令添加依赖：
```
uv add "../mypkg2"
```

##### UV 指定某个子目录添加依赖

语法：
```
uv add "git+https://github.com/<user>/<repo>.git@<ref>#subdirectory=<path>"
```

示例：
```
uv add "git+https://github.com/drawmoon/langflow.git@main#subdirectory=src/lfx"
```

示例依赖仓库的目录结构：
```
langflow/
├── src/
│   ├── .../
│   └── lfx/
|       ├── pyproject.toml
|       └── ...
├── pyproject.toml
└── README.md
```

带 egg 参数指定包名：
```
uv add "git+https://github.com/<user>/<repo>.git@<ref>#subdirectory=<path>&egg=mypkg[extra1,extra2]"
```

#### Pip
Python 官方推荐的包管理器（PyPI），只能管理 Python 包。需要与 `venv` 等工具配合管理环境。

**配置 Pip 的模块代理**

执行以下命令新建配置文件：
```bash
mkdir ~/.pip
echo >> ~/.pip/pip.conf << 'EOF'
[global]
index-url = https://pypi.doubanio.com/simple
[install]
trusted-host = pypi.doubanio.com
EOF
```
#### Miniconda
一个最小的 Conda 发行版，只包含 Conda、Python 和基础工具。你可以用它来安装 Conda 和创建环境。

- 使用 Homebrew 安装 Miniconda：
```sh
brew install --cask miniconda
```
- 使用脚本安装 Miniconda：
```sh
wget -c https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-latest-Linux-x86_64.sh

chmod +x Miniconda3-latest-Linux-x86_64.sh
./Miniconda3-latest-Linux-x86_64.sh
```
初始化 Miniconda 到当前的 Shell：
```sh
conda init "$(basename "${SHELL}")"

# 或手动指定 shell，下面以 bash 和 fish-shell 示例
# conda init bash
# conda init fish
```
配置 Miniconda 的模块代理：
为了避免冲突，清除现有通道
```sh
conda config --remove-key channels
```
添加清华大学镜像源
```sh
conda config --add channels defaults
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/msys2/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/menpo/
```
