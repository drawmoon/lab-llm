## 一、概念

**Embedding**

- **原理**：通过学习语义相似性，将文本映射为向量，在高维向量空间中进行相似度计算，即"相似的东西 → 向量距离近；不相似的东西 → 向量距离远"。
- **特点**：能理解意图，查找意思接近、表达相同意图、语义相关的文本，使系统“更聪明”，但无法保证100%正确。
- **应用**：语义搜索、RAG（检索增强生成）、相似推荐、主题聚类等。

**BM25**

- **原理**：基于概率信息检索模型，通过词频（TF）和逆文档频率（IDF）等特征计算查询词与文档中词的相关性分数来排序。
- **特点**：精确匹配、确定性、可解释、依赖于规则和硬约束。
- **应用**：传统信息检索、实体识别、指标匹配、时间解析等。

## 二、场景对比

**Embedding**
- **语义搜索**：理解“换个说法”的查询。
- **RAG（检索增强生成）**：从大量文档中找到相关内容并生成答案。
- **非结构化文档**：理解不同写法的相似内容。
- **相似推荐**：如商品推荐、工单相似度。
- **多模态搜索**：如图像和文本的相似度计算。

**BM25**
- **BI 查询解析**：如实体识别、指标匹配、时间解析。
- **精确实体匹配**：如公司名称、客户ID、财务指标等。
- **传统信息检索**：针对明确关键词的精确检索。

### 最适合用 Embedding 的场景

**语义搜索场景**
- 用户输入：
> 	“提高电网运行效率的方法”
- 文档中没有完全相同的关键词
- 能命中：
    - “电力系统优化方案”
    - “配电网运行优化策略”

为什么不能用 BM25
- 没有关键词重叠
- BM25 直接 MISS

**RAG（检索增强生成）场景**
- 对内部文档问答
- 技术手册 / 制度 / 规范

- 典型问题：
> 	“主变过载时应如何处理？”
- 找“语义相关段落”
- 再交给 LLM 生成答案

**非结构化知识理解场景**
- Word / PDF / 邮件 / 合同
- 表达极其不规范

Embedding 可以理解同义词、改写、省略，BM25 几乎无能为力。

**相似推荐（向量相似）场景**
- 相似文章
- 相似商品
- 相似工单
- 用户输入：
> 	“给我推荐类似的用电异常工单”

Embedding 的本质优势。

**多模态搜索场景**
- 图搜文
- 文搜图
- 音频相似

BM25 完全不适用。

### 可用 Embedding，但必须受控的场景

**BI 的兜底语义理解场景**
- 用户输入：
> 	“帮我看看钢铁企业今年电量”
- Embedding 用途：
	- 判断这是 BI 问数查询
	- 识别大致业务域

不负责最终实体、指标选择、条件选择

**文本聚类 / 主题发现场景**
- 客服工单聚类
- 需求分析
- 意见归纳

不涉及“对错”，只看“相似”。

**意图识别场景**
- 判断用户是问：
    - 问答
    - 问数
    - 闲聊

Embedding 很合适。

### 适合用 BM25 的场景

**BI 实体 / 指标 / 时间解析场景**

- 用户输入：
> 	“中天钢铁今年售电量”
- 规则（Regex / 分词） / LangExtract 拆解为：
	- 实体：中天钢铁
	- 时间条件：今年
	- 指标：售电量
- BM25 精确识别别名“中天钢铁”是底表的“中天钢铁集团有限公司”
- Embedding 的不可控风险，“中天钢铁” 可能更接近
	- 中天科技
	- 中天建设
	- 中天集团

原因：
- 需要 100% 确定性
- 错一次就事故

**主数据匹配（公司 / 客户 / 组织）场景**

Embedding 无法理解：
- 唯一性
- 主键
- 法律主体

**金融 / 财务 / 统计指标场景**

| 词  | 语义    |
| --- | ---    |
| 金额 | ≠ 数量 |
| 同比 | ≠ 环比 |

Embedding 容易“理解错”。

**强规则系统场景**
- 风控
- 审计
- 计费
- 合规

Embedding 只能做辅助。

## 三、主流 Embedding、BM25 库

**Embedding**

| 数据库              | 类型                          | 适用场景                                      |
|--------------------|-------------------------------|-----------------------------------------------|
| Pinecone           | 托管云向量数据库（SaaS）      | 快速开发原型、低维护 AI 应用、实时推荐与语义搜索 |
| Milvus             | 开源分布式向量数据库          | 海量向量相似性搜索、企业级推荐系统、图像/视频搜索 |
| Weaviate           | 开源向量数据库（支持托管）    | 需要复杂过滤、语义 + 关键字搜索混合的智能搜索系统 |
| Qdrant             | 开源向量数据库（Rust 写成）   | 对性能需求高、需要复杂过滤（如电商/广告）场景 |
| PgVector           | PostgreSQL 的向量搜索扩展     | 中小规模应用、已有 PostgreSQL 环境要加向量搜索的场景 |
| Redis              | 内存数据库 + 向量搜索         | 实时推荐、热数据查询等需要极低延迟的场景       |
| Chroma / LanceDB   | 嵌入式向量存储                | 个人项目、快速原型、资源受限环境              |

**BM25**

| 数据库            | 类型                          | 适用场景                                      |
|------------------|-------------------------------|-----------------------------------------------|
| Elasticsearch    | 分布式全文搜索引擎（支持向量搜索） | 企业级搜索 / BI、混合关键字与语义搜索、日志分析 |
| OpenSearch       | 开源分布式搜索引擎（支持向量搜索） | 开源替代 ES、混合搜索、企业级全文与向量检索   |
| Apache Lucene    | 开源搜索库（支持向量搜索）    | 搜索底座、构建自定义搜索引擎                  |
| Solr             | 基于 Lucene 的搜索引擎        | 传统搜索、企业级全文搜索与向量混合            |
| rank-bm25        | Python BM25 实现库            | 最流行的 Python BM25、快速原型与离线排名      |
| Gensim BM25      | Python BM25 实现（Gensim 库） | 教学 / 离线、NLP 实验与文档排名               |
| Whoosh           | 纯 Python 全文搜索库          | 小型搜索、纯 Python 应用、本地小型索引        |
| Tantivy          | Rust 全文搜索库               | 本地搜索、高性能嵌入式搜索、Rust 应用         |

## 四、性能与成本

| 维度 | Embedding | BM25 |
| --- | --- |---|
| 计算成本 | 高（向量计算） | 低（统计计算） |
| 存储成本 | 高（向量存储） | 低（倒排索引） |
| 查询延迟 | 中 | 低 |
| 架构复杂度 | 高（模型、存储、运维） | 低 |

## 五、总结

- **Embedding**：适用于需要“模糊理解”的场景，能处理同义词、改写、模糊查询，但不能保证100%正确。
- **BM25**：适用于需要精确匹配的场景，能提供确定性排序，非常适合BI、财务和法务类系统。
- **组合使用**：在实际生产中，BM25 + Embedding 组合使用，Embedding 用于理解用户意图，BM25 用于精确实体匹配和最终决策。

**Embedding 与 BM25 正确工程位置**
```
用户自然语言
   ↓
Embedding（意图 / 语义理解）
   ↓
规则 / BM25（实体 / 指标）
   ↓
  业务
```

**Embedding vs BM25 的 “分界线”**
> 错了能不能接受？

| 能不能错      | 用什么         |
| ---          | ---           |
| 不能错        | 规则 / BM25   |
| 可以模糊      | Embedding     |
| 错了只是体验差 | Embedding     |
